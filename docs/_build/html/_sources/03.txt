======================
BLEゲートウェイの設定
======================

レンジャーシステムズ製のBLEゲートウェイの設定を行います。


電源投入
======

レンジャーシステムズ製のBLEゲートウェイは、USBで給電する仕組みになっています。

USBケーブルを本体に接続し、電源供給元(USBコンセント、PCのUSBポート等)に接続してください。

WiFi設定
========

本ゲートウェイは、初期状態ではWiFiアクセスポイント(親機)モードになっており、PCから直接、WiFiで接続し、設定を行います。

電源投入後、ゲートウェイの起動が終わると、WiFi接続が可能なPC等のネットワーク画面で「IGS0X_YY_ZZ」というSSIDが表示されます。

* ハンズオンで使用するゲートウェイのモデル名は、iGS01です。SSIDは、「IGS01_YY_ZZ」になります。
* モデルがiGS02の場合、SSIDは、「IGS02_YY_ZZ」になります。
* YY_ZZ は、ゲートウェイの背面に記録されているMACアドレスの下２桁になります。
  * MACアドレスが、"AC83F3A041D2"の場合、SSIDは、"GS01_**41_D2**"になります。

  .. image:: images/03/MAC.png

  |

* ご自身のゲートウェイのSSIDに接続して下さい。
* WiFiのパスワードは、"12345678"です。


WiFiの設定を行います。ログイン後、**configure_edison --wifi** コマンドでSSIDとPSK(パスワード)の設定を実施してください。



WiFiの接続が不安定な場合、再接続すれば回復することがあります。
お使いのWiFiネットワークが5GHz帯をサポートしている場合は、安定して通信できますので、可能であれば2.4GHzではなく5GHzのWiFiを使用して下さい。

インターネットに接続できるか確認します。IPアドレスが表示されれば成功です。

::

  # curl http://checkip.amazonaws.com/

|

接続の確認方法

::

  # iwconfig
   wlan0    IEEE 802.11abgn  ESSID:"Guest"
            Mode:Managed  Frequency:5.5 GHz  Access Point: 24:DE:C6:4C:CB:E9
            Bit Rate=65 Mb/s   Tx-Power=31 dBm
  ...

|

Frequency:X.X GHz のところで周波数を確認できます。

再接続を行うには、下記を実行して下さい。

::

  # ifconfig wlan0 down      << WiFi OFF
   # ifconfig wlan0 up        << WiFi ON

|

Edison環境のクリーンアップ
============================

ハンズオンで利用するユーザーディレクトリのクリーンアップを行います。

::

    # cd
     # rm -rf *
     # rm -rf ./.aws
     ＃rm -f ./.profile

|

AWS SDKの準備
========

Edison上でAWS IoTデバイスSDK、AWS SDK、その他のモジュールをインストールします。

::

    # npm install aws-iot-device-sdk
     # npm install aws-sdk
     # npm install argv
     # npm install moment

|

環境変数の設定
============

参加者番号を設定します。以下の01となっている箇所を各自の参加者番号に変更して実行します。

::

    # echo "export HandsOnNumber=01" >> .profile
     # source ./.profile

|

ハンズオン用コード、証明書の準備
============================

Edison上で以下のコマンドを実行し、本ハンズオン用に用意されているzipファイルのダウンロードと解凍を行います。

::

    # cd
     # wget https://s3-ap-northeast-1.amazonaws.com/awsiot-handson-dojo-jp/aws-iot-handson-dojo-basic.zip
     # unzip -q aws-iot-handson-dojo-basic.zip

|

デバイス用証明書の準備を行います。解凍して作成されたaws-iot-handson-dojo-basic/certsディレクトリに移動し、OpenSSLを使ってプライベートキー(privatekey.pem)と証明書リクエスト(cert.csr)を生成します。

::

    # cd ~/aws-iot-handson-dojo-basic/certs/
     # openssl req -newkey rsa:2048 -new -nodes -keyout privatekey.pem -out cert.csr -subj "/CN=awshandson"

|

スクリプトの実行に必要なモジュールのインストールし、「2. AWS環境の準備」の最後でコピーしたCloudFormationのOutputに表示されたAccessKeyとSecretKeyをパラメータに指定してスクリプトを実行します。AWS IoTで証明書の作成と登録が行われます。出力される「証明書ID」をメモ帳にコピーします。次章のAWS IoTの設定の中で証明書を特定するために利用します。

::

    # node create_cert.js -a <your access key> -s <your secret key>
     certificateId: '<証明書ID>'

|

デバイス用証明書ファイル(cert.crt)がcertsディレクトリ内に作成されたことを確認します。

::

    # ls
     cert.csr         cert.pem         create_cert.js   get_endpoint.js  privatekey.pem

|

ルート証明書のダウンロードを行います。

::

  # wget https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem -O rootca.crt

|
